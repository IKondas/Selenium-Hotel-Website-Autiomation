#This test fills out the contact form with the data given to it in the 'clients' list
# -------------------------- Imports ----------------------
import __init__
import pytest
import Selenium2_Test.source.my_functions as mf
from Selenium2_Test.tests.conftest import Client
from Selenium2_Test.tests.conftest import TextField_Name
from Selenium2_Test.tests.conftest import TextField_Email
from Selenium2_Test.tests.conftest import TextField_Phone
from Selenium2_Test.tests.conftest import TextField_Subject
from Selenium2_Test.tests.conftest import TextField_Description

# -------------------------- Data setup --------------------------
form_errors = []
text_fields = [
    TextField_Name("name", 1),
    TextField_Email("email", 1),
    TextField_Phone("phone", 11, 21),
    TextField_Subject("subject", 5, 100),
    TextField_Description("description", 20, 2000)
]   

#Clients testing different configuration of limitations + upper/lower boundaries of valid data
clients = [
    Client("", "", "", "", ""),
    Client("j", "e@e..", "1234512345", "1234", "12345123451234"),
    Client("John Test 123456 !@#$% weirdname.]", ".!#$%^@weirdmail", "1234512345123451234512", "12345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451", "123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451"),
    Client("Valid Upper", "E@e", "123451234512345123451", "1234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345", "12345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345123451234512345"),
    Client("Valid Lower", "Email@email.com", "09876543212", "subjc", "12345123451234512345"),
    Client("     ", "    ", "            ", "         ", "                        "),
    ]

# -------------------------- Test --------------------------
@pytest.fixture(params=clients)
def logins(request):
    return request.param

def test_group(logins, subtests):

    with subtests.test("Wait for form elements to load"):
        mf.load_website()
        mf.wait_for_form_elements_to_load(text_fields)

    with subtests.test("Fill out form"):
        mf.populate_text_fields(text_fields, logins)

    with subtests.test("Check if text was entered"):
        mf.check_text(text_fields, logins)

    with subtests.test("Click the send button"):
        mf.click_button(True, mf.load_element("/html/body/div[2]/div/section[3]/div/div/div/div/div/form/div[6]/button"))
        #The button sometimes does not load the box, so expect some Timeout Exceptions

    with subtests.test("Check if client data is acceptable"):
        form_errors = mf.verify_data(text_fields, logins)

    if len(form_errors) == 0:
        with subtests.test("Verify form sent confirmation message"):
            mf.verify_form_success(logins)
    else:
        with subtests.test("Verify form data error info"):
            mf.verify_form_failure(form_errors)